groups:
  - name: queue-increase
    rules:
      - alert: QueueIncrease
        expr: avg(deriv(tasks_in_queue_count[10s])) / avg(tasks_in_progress_count) / avg(complete_waiting_time / complete_waiting_time) > 0
        annotations:
          summary: Queue increase coefficient
          queue_increase_coefficient: "{{ $value }}"

  - name: queue-decrease
    rules:
      - alert: QueueDecrease
        expr: avg(deriv(tasks_in_queue_count[10s])) / avg(tasks_in_progress_count) / avg(complete_waiting_time / complete_waiting_time) < 0
        annotations:
          summary: Queue decrease coefficient
          queue_decrease_coefficient: "{{ $value }}"

  - name: waiting-too-long
    rules:
      - alert: WaitingTooLong
        expr: predict_linear(extracted_tasks_waiting_time{role="role-1"}[10s], 10) > 30
        for: 1m
        annotations:
          summary: Tasks from account with role role-1 is waiting too long
          waiting_time: "{{ $value }}"
